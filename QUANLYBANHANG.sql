create database QUANLYHANGHOA;
use QUANLYHANGHOA;
create table MATHANG(
MAHANG varchar(6) primary key,
TENHANG varchar(30) ,
DONHANG int 

);
insert into MATHANG values('M1','Dưỡng môi Ohui',200000);
insert into MATHANG values('M2','Tinh chất Ohui',1000000);
insert into MATHANG values('M3','Kem dưỡng Ohui',550000);
select * from MATHANG;
create table KHACHHANG(
MAKH varchar(6) primary key,
TENKH varchar(30) ,
GIOITINH varchar(6),
QUEQUAN varchar(30)

);
insert into KHACHHANG values('K1','Trần Triệu Vy','Nữ','Hà Nội');
insert into KHACHHANG values('K2','Trần Đình Trọng','Nam','Thái Bình');
insert into KHACHHANG values('K3','Minh Hà','Nữ','Sài Gòn');


select * from KHACHHANG;
create table HOADON(
SOPHIEU  varchar(6) primary key,
NGAYLAP  varchar(30) ,
MAKH varchar(6),
foreign key(MAKH) references KHACHHANG (MAKH)
);
insert into HOADON values('P1','3/3/2019','K1');
insert into HOADON values('P2','8/3/2019','K1');
insert into HOADON values('P3','8/4/2019','K3');
create table CTHOADON(
SOPHIEU  varchar(6),
MAHANG varchar(6),
SOLUONG int ,
 primary key(SOPHIEU,MAHANG),
foreign key(SOPHIEU) references HOADON  (SOPHIEU),
foreign key(MAHANG) references MATHANG  (MAHANG)
);
insert into CTHOADON values('P1','M1',2);
insert into CTHOADON values('P1','M2',3);
insert into CTHOADON values('P2','M2',1);
SELECT * from CTHOADON;
select MAKH,TENKH,GIOITINH from KHACHHANG
where TENKH like 'Trần%' and QUEQUAN='Hà Nội';
select  KHACHHANG.MAKH,KHACHHANG.TENKH, SUM(CTHOADON.SOLUONG * MATHANG.DONGGIA) as Tongtien
from KHACHHANG 
JOIN HOADON ON KHACHHANG.MAKH = HOADON.MAKH
group by KHACHHANG.MAKH, KHAHCHANG.TENKH
having  SUM(CTHOADON.SOLUONG * MATHANG.DONGGIA) >= 1000000;
SELECT KHACHHANG.MAKH, KHACHHANG.TENKH, SUM(CTHOADON.SOLUONG * MATHANG.DONHANG) AS TongTien
FROM KHACHHANG
JOIN HOADON ON KHACHHANG.MAKH = HOADON.MAKH
JOIN CTHOADON ON HOADON.SOPHIEU = CTHOADON.SOPHIEU
JOIN MATHANG ON CTHOADON.MAHANG = MATHANG.MAHANG
GROUP BY KHACHHANG.MAKH, KHACHHANG.TENKH
HAVING SUM(CTHOADON.SOLUONG * MATHANG.DONHANG) >= 1000000;

SELECT KHACHHANG.MAKH, KHACHHANG.TENKH
FROM KHACHHANG
LEFT JOIN HOADON ON KHACHHANG.MAKH = HOADON.MAKH
WHERE HOADON.SOPHIEU IS NULL;
SELECT KHACHHANG.MAKH, KHACHHANG.TENKH, MATHANG.MAHANG, MATHANG.TENHANG, MATHANG.DONHANG, CTHOADON.SOLUONG
FROM KHACHHANG
JOIN HOADON ON KHACHHANG.MAKH = HOADON.MAKH
JOIN CTHOADON ON HOADON.SOPHIEU = CTHOADON.SOPHIEU
JOIN MATHANG ON CTHOADON.MAHANG = MATHANG.MAHANG
WHERE KHACHHANG.TENKH = 'Trần Triệu Vy';
INSERT INTO CTHOADON VALUES ('P3','M3',1);
SET SQL_SAFE_UPDATES = 0;
UPDATE KHACHHANG 
SET QUEQUAN='Miền Tây'
WHERE TENKH='Minh Hà';

DELETE FROM MATHANG
WHERE TENHANG='Kem dưỡng Ohui'
